@startuml
skinparam classAttributeIconSize 0

package Services <<Folder>> {

class PagamentoService {
  - Pagar()
  - Receber()
}

class EmailService {
  - ObterQRCode()
  - EnviarEmail()
}

}

package Controllers <<Folder>> {

class UtilizadoresController {
  +Get GetUtilizador()
  +Get GetUtilizadorById(nif)
  +Post PostUtilizador()
  +Put PutUtilizador(nif, Utilizador)
  +Delete DeleteUtilizador(nif)
}

class ReservasController {
  +Get GetReserva()
  +Get GetReservaById(id)
  +Post PostReserva()
  +Delete DeleteReserva(id)
  +FindAvailable(freguesia, inicio, fim)
}

class TransacoesController {
  +Get GetTransacao()
  +Get GetTransacaoById(id)
  +Post PostTransacao()
}

class ParquesController {
  +Get GetParque()
  +Get GetParqueById(id)
  +Post PostParque()
  +Put PutParque(id, parque)
  +Delete DeleteParque(id)
}

class MetodoPagamentosController {
  +Get GetMetodoPagamento()
  +Get GetMetodoPagamentoById(id)
  +Post PostMetodoPagamento()
  +Put PutMetodoPagamento(id, metodoPagamento)
  +Delete DeleteMetodoPagamento(id)
}

}

package Models <<Folder>> {

class Utilizador{
  -Int nif PK
  -String nome
  -String email
  -Double carteira
  -Int credencialId
}

class Reserva {
  -Int id PK
  -Int nifUtilizador FK
  -Int parqueId FK
  -Double custo
  -Int transacaoID FK
  -Int reservaParqueId
}

class Transacao {
  -Int Id PK
  -Int nifPagador FK
  -Int nifRecepiente FK
  -Double valor
  -DateTime dataHora
  -Int metodoId FK
}

class Parque {
  -Int Id PK
  -String api_url
}

class MetodoPagamento {
  -Int Id PK
  -String nome
  -String api_url
}

package "Abstract Class Credencial" <<Frame>> {

abstract class Credencial {
}

abstract PayPal:Credencial {
  -Int Id PK
  -String email
  -String password
  -Int metodoID FK
}

abstract Cartao:Credencial {
  -Int Id PK
  -Int numero
  -String nome
  -DateTime dataValidade
  -Int cvc
  -Int metodoID FK
}

abstract DebitoDireto:Credencial {
  -Int Id PK
  -String iban
  -String nome
  -String rua
  -String codigoPostal
  -String freguesia
  -DateTime dataSubscricao
  -Int metodoID FK
}

}

}

package Data <<Folder>> {

class Context {
  -DbSet<Utilizador> Utilizadores
  -DbSet<Reserva> Reservas
  -DbSet<Transacao> Transacoes
  -DbSet<Parque> Parques
  -DbSet<MetodoPagamento> MetodosPagamento
  -DbSet<Paypal> Paypal
  -DbSet<Cartao> Cartoes
  -DbSet<DebitoDireto> DebitosDiretos
}

}

package DTOs <<Folder>> {

class ReservaDTO {
  -String RuaParque
  -Int NumeroLugar
  -String FilaLugar
  -Int AndarLugar
  -DateTime inicio
  -DateTime fim
}

class paypalDTO {
  -String email
  -String password
  -Double custo
  -String emailDestinatario
  -DateTime data
}

class cartaoDTO {
  -Int numero
  -String nome
  -DateTime dataValidade
  -Int cvc
  -Double custo
  -Int nifDestinatario
  -DateTime data
}

class debitoDiretoDTO {
  -String iban
  -String nome
  -String rua
  -String codigoPostal
  -String freguesia
  -Double custo
  -Int nifDestinatario
  -DateTime data
}

}

UtilizadoresController ..> Utilizador
UtilizadoresController ..> Context
ReservasController ..> Reserva
ReservasController ..> Context
ReservasController ..> PagamentoService
ReservasController ..> EmailService
TransacoesController ..> Transacao
TransacoesController ..> Context
ParquesController ..> Parque
ParquesController ..> Context
MetodoPagamentosController ..> MetodoPagamento
MetodoPagamentosController ..> Context

Context "1" --> "0..*" Utilizador: tem
Context "1" --> "0..*" Reserva: tem
Context "1" --> "0..*" Transacao: tem
Context "1" --> "0..*" Parque: tem
Context "1" --> "0..*" MetodoPagamento: tem
Context "1" --> "0..*" "PayPal:Credencial": tem
Context "1" --> "0..*" "Cartao:Credencial": tem
Context "1" --> "0..*" "DebitoDireto:Credencial": tem

Reserva "0..*" --> "1" Utilizador: tem
Reserva "0..*" --> "1" Transacao: tem
Transacao"1..*" --> "1" Parque: tem
Parque "0..*" --> "1" MetodoPagamento: tem
Utilizador "1" --> "1" Credencial: tem
Credencial --> "PayPal:Credencial": pode ser
Credencial --> "Cartao:Credencial": pode ser
Credencial --> "DebitoDireto:Credencial": pode ser
"PayPal:Credencial" "0..*" --> "1" MetodoPagamento: tem
"Cartao:Credencial" "0..*" --> "1" MetodoPagamento: tem
"DebitoDireto:Credencial" "0..*" --> "1" MetodoPagamento: tem
@enduml